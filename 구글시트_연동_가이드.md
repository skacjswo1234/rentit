# 구글 시트 연동 가이드

## 📋 작업 순서

### 1단계: 구글 시트 생성 및 헤더 설정

1. **구글 시트 생성**
   - Google Drive에 접속 (https://drive.google.com)
   - 새로 만들기 → Google 스프레드시트 클릭
   - 시트 이름을 "렌트잇 문의폼" 등으로 변경

2. **시트 헤더 설정**
   - 첫 번째 행(A1~G1)에 다음 헤더를 입력하세요:
   
   | A1: 제출일시 | B1: 이름 | C1: 연락처 | D1: 문의차량 | E1: 상담방식 | F1: 문의사항 | G1: 개인정보동의 |
   |-------------|---------|-----------|------------|------------|------------|----------------|
   
   또는 한글로:
   - A1: `제출일시`
   - B1: `이름`
   - C1: `연락처`
   - D1: `문의차량`
   - E1: `상담방식`
   - F1: `문의사항`
   - G1: `개인정보동의`

3. **시트 공유 설정**
   - 시트 우측 상단의 "공유" 버튼 클릭
   - "링크가 있는 모든 사용자" 또는 "모든 사용자"로 설정
   - 권한은 "편집자"로 설정 (나중에 Apps Script가 데이터를 추가할 수 있도록)

### 2단계: Google Apps Script 작성

1. **Apps Script 에디터 열기**
   - 구글 시트에서 확장 프로그램 → Apps Script 클릭
   - 또는 https://script.google.com 접속

2. **스크립트 코드 작성**
   - 아래 코드를 복사하여 Apps Script 에디터에 붙여넣기:

```javascript
function doPost(e) {
  try {
    // 시트 ID 가져오기 (URL에서 확인 가능)
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    
    // 현재 날짜와 시간 가져오기
    var timestamp = new Date();
    var formattedDate = Utilities.formatDate(timestamp, "Asia/Seoul", "yyyy-MM-dd HH:mm:ss");
    
    // 전송받은 데이터 파싱
    var data = JSON.parse(e.postData.contents);
    
    // 상담 방식 한글 변환
    var contactMethodMap = {
      'phone': '전화 상담',
      'kakao': '카카오톡 상담',
      'visit': '방문 상담'
    };
    var contactMethod = contactMethodMap[data['contact-method']] || data['contact-method'];
    
    // 개인정보 동의 여부
    var consent = data['privacy-consent'] ? '동의' : '비동의';
    
    // 시트에 데이터 추가 (헤더 다음 행부터)
    sheet.appendRow([
      formattedDate,                    // A열: 제출일시
      data['customer-name'] || '',      // B열: 이름
      data['customer-phone'] || '',     // C열: 연락처
      data['preferred-model'] || '',    // D열: 문의차량
      contactMethod,                    // E열: 상담방식
      data['customer-message'] || '',   // F열: 문의사항
      consent                           // G열: 개인정보동의
    ]);
    
    // 성공 응답 반환
    return ContentService
      .createTextOutput(JSON.stringify({
        'success': true,
        'message': '문의가 성공적으로 접수되었습니다.'
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    // 에러 응답 반환
    return ContentService
      .createTextOutput(JSON.stringify({
        'success': false,
        'message': '오류가 발생했습니다: ' + error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
```

3. **스크립트 저장**
   - 상단의 "프로젝트 이름 없음" 클릭하여 프로젝트 이름 변경 (예: "렌트잇 문의폼 연동")
   - Ctrl+S 또는 파일 → 저장

### 3단계: Web App으로 배포

1. **배포 설정**
   - Apps Script 에디터에서 "배포" → "새 배포" 클릭
   - 또는 우측 상단의 "배포" 버튼 클릭

2. **배포 옵션 설정**
   - 유형 선택: "웹 앱" 선택
   - 설명: "렌트잇 문의폼 연동" (선택사항)
   - 다음으로 실행: "me" (본인 계정)
   - 액세스 권한: "모든 사용자" 선택
   - "배포" 버튼 클릭

3. **권한 승인**
   - "권한 확인" 버튼 클릭
   - Google 계정 선택
   - "고급" → "렌트잇 문의폼 연동(안전하지 않음)으로 이동" 클릭
   - "허용" 클릭하여 권한 승인

4. **Web App URL 복사**
   - 배포 완료 후 나타나는 "웹 앱 URL" 복사
   - 예시: `https://script.google.com/macros/s/AKfycby.../exec`
   - 이 URL을 안전한 곳에 저장하세요!

### 4단계: HTML 파일에 연동 코드 추가

1. **index.html 파일 수정**
   - 프로젝트의 `index.html` 파일을 엽니다
   - 문의폼의 `action="#"` 부분을 제거하고 JavaScript로 처리하도록 수정합니다
   - 아래 코드가 이미 추가되어 있을 것입니다

2. **Web App URL 설정**
   - HTML 파일의 JavaScript 부분에서 `YOUR_WEB_APP_URL` 부분을 3단계에서 복사한 URL로 교체하세요

### 5단계: 테스트

1. **로컬 테스트**
   - HTML 파일을 브라우저에서 열기
   - 문의폼에 테스트 데이터 입력 후 제출
   - 구글 시트에서 데이터가 추가되었는지 확인

2. **실제 배포 후 테스트**
   - 웹 서버에 업로드 후 실제로 테스트
   - 구글 시트에서 실시간으로 데이터 확인

## ⚠️ 주의사항

1. **보안**
   - Web App URL은 공개되면 누구나 사용할 수 있습니다
   - 필요시 Apps Script에 추가 인증 로직을 구현하세요

2. **시트 ID 확인 방법**
   - 구글 시트 URL 예시: `https://docs.google.com/spreadsheets/d/시트ID/edit`
   - `시트ID` 부분을 복사하여 사용할 수 있습니다

3. **일일 할당량**
   - Google Apps Script는 일일 실행 시간 제한이 있습니다
   - 일반적인 사용량에서는 문제없지만, 매우 많은 요청이 있을 경우 제한될 수 있습니다

## 🔧 문제 해결

### 데이터가 시트에 추가되지 않는 경우
- Web App URL이 올바른지 확인
- 시트 공유 설정이 "편집자" 권한인지 확인
- Apps Script의 권한이 올바르게 승인되었는지 확인
- 브라우저 개발자 도구(F12)의 콘솔에서 에러 메시지 확인

### CORS 오류가 발생하는 경우
- Apps Script의 `doPost` 함수가 올바르게 반환하는지 확인
- Web App 배포 시 "액세스 권한"이 "모든 사용자"로 설정되었는지 확인

